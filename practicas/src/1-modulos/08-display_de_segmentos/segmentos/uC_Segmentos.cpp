/*******************************************************************************************************************************//**
 *
 * @file		75X595.cpp
 * @brief		Segmentos manejados por el integrado 75X595
 * @date		27 jul. 2022
 * @author		Ing. Marcelo Trujillo
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "uC_Segmentos.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** IMPLEMENTACION DE LOS METODODS DE LA CLASE
 **********************************************************************************************************************************/
bool uC_Segmentos::SetSegmentos( uint8_t bcd )
{
	uint8_t sgm , dp ;

	if ( (bcd & 0x0f ) > 9 )
		return false ;

	dp = bcd & 0x80 ;
	bcd = bcd & 0x0f ;
	sgm = m_tabla[ bcd ] | dp;
	for ( uint8_t i = 0 ; i < 8 ; i++ )
	{
		if( sgm & ( 1 << i) ) 	m_segmentos[i]->SetPin();
		else 					m_segmentos[i]->ClrPin();
	}
	return true ;
}

uC_Segmentos::uC_Segmentos(Gpio **segmentos,uint8_t* tabla): 
	m_segmentos (segmentos) , m_tabla (tabla)
{
	SetSegmentos( 0 );
}

void uC_Segmentos::ClrSegmentos(void)
{
	for ( uint8_t i = 0 ; i < 8 ; i++ )
		m_segmentos[i]->ClrPin();
}

uC_Segmentos::~uC_Segmentos() {
	// TODO Auto-generated destructor stub
}
